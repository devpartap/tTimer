<ons-page id="helloworld-page">
    <ons-toolbar>
      <div class="left">
        <ons-toolbar-button onclick="fn.open()" style="color: SlateBlue;" icon="ion-ios-menu, material:md-menu"></ons-toolbar-button>
      </div>

      <div class="center">STv2</div>

      <div class="right">
        <ons-toolbar-button onclick="copycommand()" style="color: SlateBlue;" id="buttocom" icon="ion-ios-clipboard, material:md-copy"></ons-toolbar-button>
      </div>
    </ons-toolbar>
  
    <br><br><br><br><br>
    <div id="_sTime" style="text-align: center;font-size: 80px">00:00:00</div>
    <br><br><br>
    
    <div style="margin-right: 30px; margin-left: 30px;">
    <ons-button modifier="large" id="mainbut" onclick="changestate()" ripple="true">Start Studing</ons-button>
    </div>

    <table class="tableBottom">
      <tr style="height: 80px;">
        <td style="border-right: 1px solid; color:#1f1f21;">
          <h2 id="_nsTime">00:00:00</h2>
          <p style="font-size: 12px;position: relative;top: -12;">Time Not Studied</p>
        </td>
        <td style=" color:#1f1f21;">
          <h2 id="_tTime">00:00:00</h2>
          <p style="font-size: 12px;position: relative;top: -12; word-spacing: 2px;">Total      Sit  Time</p>
        </td> 
      </tr>
    </table>
    </div>


  <script>

  var state = false;
  var stime = [0,0,0];
  var nstime= [0,0,0];
  var tNow  = [0,0,0];

  var istimeset = false;
  var Interval;

  const sTimer = document.getElementById('_sTime');
  const nsTimer = document.getElementById('_nsTime');
  const tTimer = document.getElementById('_tTime');
  const butto = document.getElementById("mainbut");


  function updateTotalTime()
{
  var hrs = stime[0] + nstime[0];
  var min = stime[1] + nstime[1];
  var sec = stime[2] + nstime[2];

   if(sec >= 60){
    sec -= 60;
    min += 1;
   }
   if(min >= 60){
    min -= 60;
    hrs += 1;
   }

  tTimer.innerHTML = returnStr([hrs,min,sec]);
}

  function countStuding() {

    stime = subTime(timeEclipsed(),nstime);
    sTimer.innerHTML = returnStr(stime);
    updateTotalTime();

}  

function countnStuding() {

  nstime = subTime(timeEclipsed(),stime);
  nsTimer.innerHTML = returnStr(nstime);
  updateTotalTime();

}  

function returnStr(data)
{
  var towrite = "";
    if(data[0] <= 9){
      towrite += "0";
    }
    towrite += data[0] + ":";
    if (data[1]<= 9) {
      towrite += "0";
    }
    towrite += data[1] + ":";
    if (data[2]<= 9) {
      towrite += "0";
    }
    towrite += data[2].toString();
    return towrite;
}

function timeEclipsed()
{
  var et = new Date;
  return subTime([et.getHours(),et.getMinutes(),et.getSeconds()],tNow);
}

function subTime(from,to)
{
  var s = 0;
  var m = 0;
  var h = 0;
    if(from[2] >= to[2])
    {
        s = from[2] - to[2];
        if(from[1] >= to[1]) 
        {
            m = from[1] - to[1];
            h = from[0] - to[0];
        }
        else   
        {
            m = 60 + from[1] - to[1];
            h = from[0] - to[0] - 1;
        }
    }
    else{
        if(from[1] >= to[1]) 
        {
            m = from[1] - to[1]- 1;
            s = 60 + from[2] - to[2];
            h = from[0] - to[0];
        }
        else
        {
            m = 60 + from[1] - to[1] - 1;
            s = 60 + from[2] - to[2];
            h = from[0] - to[0] - 1;
        }
    }

    return [h,m,s] 
}


function changestate()
  {
    if(!istimeset)
    {
      var tn = new Date;
      tNow = [tn.getHours(),tn.getMinutes(),tn.getSeconds()]
      istimeset = true;
    }
    if(state) {
      butto.innerHTML = "Start Studing";
      state = !state;
      clearInterval(Interval);
      Interval = setInterval(countnStuding,1000);
    }
    else {
      butto.innerHTML = "Stop";
      state = !state;
      clearInterval(Interval);style="color: SlateBlue;"
      Interval = setInterval(countStuding,1000);
    }
  }

  function copyStringToClipboard (str) {
   // Create new element
   var el = document.createElement('textarea');
   // Set value (string to be copied)
   el.value = str;
   // Set non-editable to avoid focus and move outside of view
   el.setAttribute('readonly', '');
   el.style = {position: 'absolute', left: '-9999px'};
   document.body.appendChild(el);
   // Select text inside element
   el.select();
   // Copy text to clipboard
   document.execCommand('copy');
   // Remove temporary element
   document.body.removeChild(el);
}


  function copycommand()
  {
    // format -> add ss tt end
    var today = new Date;
    var command = returnStr(stime) + " " + returnStr(nstime) + " " + returnStr([today.getHours(),today.getMinutes(),today.getSeconds()]);
    console.log(command);


    copyStringToClipboard("+" + command);
    ons.notification.toast(command + "  copied!",{
      buttonLabel:"yo",
      timeout:20000,
      animation:"lift"
    });
  }

</script>
</ons-page>
